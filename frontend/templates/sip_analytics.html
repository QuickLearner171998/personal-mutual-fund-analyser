{% extends "base.html" %}

{% block title %}SIP Analytics - MF Portfolio Analyzer{% endblock %}

{% block content %}
<div>
    <div style="margin-bottom: 2rem;">
        <h1>SIP Analytics</h1>
        <p style="color: var(--text-secondary);">Track your systematic investment plans</p>
    </div>

    {% if analytics %}
    <!-- Analytics Metrics -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">Active SIPs</div>
            <div class="metric-value">{{ analytics.data.active_sips }}</div>
            <div class="metric-change">{{ analytics.data.total_sips }} total</div>
        </div>

        <div class="metric-card">
            <div class="metric-label">Monthly Outflow</div>
            <div class="metric-value">{{ analytics.data.monthly_outflow|currency }}</div>
            <div class="metric-change">Avg: {{ analytics.data.avg_sip_amount|currency }}</div>
        </div>

        <div class="metric-card">
            <div class="metric-label">Upcoming (30 days)</div>
            <div class="metric-value">{{ upcoming.count }}</div>
            <div class="metric-change">{{ upcoming.total_amount|currency }}</div>
        </div>
    </div>

    <!-- Upcoming SIPs -->
    {% if upcoming and upcoming.upcoming_sips %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Upcoming SIP Installments</h3>
            <p style="color: var(--text-muted); font-size: 0.875rem;">Next 30 days</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Scheme Name</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Days Until</th>
                        <th>Broker</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sip in upcoming.upcoming_sips %}
                    <tr>
                        <td>{{ sip.scheme_name|truncate_text(50) }}</td>
                        <td>{{ sip.sip_amount|currency }}</td>
                        <td>{{ sip.date }}</td>
                        <td>
                            <span
                                class="{% if sip.days_until <= 3 %}text-danger{% elif sip.days_until <= 7 %}text-warning{% else %}text-success{% endif %}">
                                {{ sip.days_until }} days
                            </span>
                        </td>
                        <td>{{ sip.broker }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- All SIPs -->
    {% if sips %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All SIPs</h3>
            <p style="color: var(--text-muted); font-size: 0.875rem;">{{ sips|length }} total</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Scheme Name</th>
                        <th>SIP Amount</th>
                        <th>Frequency</th>
                        <th>Last Installment</th>
                        <th>Broker</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sip in sips %}
                    <tr>
                        <td>{{ sip.scheme_name|truncate_text(50) }}</td>
                        <td>{{ sip.sip_amount|currency }}</td>
                        <td>{{ sip.frequency }}</td>
                        <td>{{ sip.last_installment_date }}</td>
                        <td>{{ sip.broker }}</td>
                        <td>
                            <span style="color: {% if sip.is_active %}var(--success){% else %}var(--danger){% endif %}">
                                {% if sip.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="card" style="text-align: center; padding: 4rem 2rem;">
        <h2 style="color: var(--text-muted); margin-bottom: 1rem;">No SIP Data</h2>
        <p style="color: var(--text-muted); margin-bottom: 2rem;">
            Please upload your portfolio data first
        </p>
        <a href="{{ url_for('upload') }}" class="btn btn-primary">Upload Data</a>
    </div>
    {% endif %}
</div>
{% endblock %}