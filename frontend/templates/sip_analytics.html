{% extends "base.html" %}

{% block title %}SIP Analytics - MF Portfolio Analyzer{% endblock %}

{% block content %}
<div>
    <div style="margin-bottom: 2rem;">
        <h1>SIP Analytics</h1>
        <p style="color: var(--text-secondary);">Track your systematic investment plans</p>
    </div>

    {% if analytics %}
    <!-- Analytics Metrics -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">Active SIPs</div>
            <div class="metric-value">{{ analytics.data.active_sips }}</div>
            <div class="metric-change">{{ analytics.data.inactive_sips }} inactive</div>
        </div>

        <div class="metric-card">
            <div class="metric-label">Monthly Outflow</div>
            <div class="metric-value">{{ analytics.data.monthly_outflow|currency }}</div>
            <div class="metric-change">Avg: {{ analytics.data.avg_sip_amount|currency }}</div>
        </div>

        <div class="metric-card">
            <div class="metric-label">Total Invested (SIPs)</div>
            <div class="metric-value">{{ analytics.data.total_invested|currency }}</div>
            <div class="metric-change">Current: {{ analytics.data.total_current_value|currency }}</div>
        </div>

        <div class="metric-card">
            <div class="metric-label">SIP Returns</div>
            <div class="metric-value" style="color: {% if analytics.data.total_returns > 0 %}var(--success){% elif analytics.data.total_returns < 0 %}var(--danger){% else %}var(--text-secondary){% endif %}">
                {{ analytics.data.total_returns|currency }}
            </div>
            <div class="metric-change">
                {% if analytics.data.total_returns > 0 %}
                +{{ (analytics.data.total_returns / analytics.data.total_invested * 100)|round(2) }}%
                {% else %}
                {{ (analytics.data.total_returns / analytics.data.total_invested * 100)|round(2) }}%
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Active SIPs -->
    {% if active_sips %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Active SIPs</h3>
            <p style="color: var(--text-muted); font-size: 0.875rem;">{{ active_sips|length }} active systematic investment plans</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 30%;">Scheme Name</th>
                        <th>SIP Amount</th>
                        <th>Frequency</th>
                        <th>Total Invested</th>
                        <th>Current Value</th>
                        <th>Returns</th>
                        <th>Returns %</th>
                        <th>XIRR %</th>
                        <th>Last Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sip in active_sips %}
                    <tr>
                        <td>
                            <div class="scheme-name" title="{{ sip.scheme_name }}">
                                {{ sip.scheme_name }}
                            </div>
                            <span class="folio-number">{{ sip.folio_number }}</span>
                        </td>
                        <td>{{ sip.sip_amount|currency }}</td>
                        <td>{{ sip.frequency }}</td>
                        <td>{{ sip.total_invested_sip|currency }}</td>
                        <td><strong>{{ sip.current_value|currency }}</strong></td>
                        <td style="color: {% if sip.absolute_returns > 0 %}var(--success){% elif sip.absolute_returns < 0 %}var(--danger){% else %}var(--text-secondary){% endif %}">
                            {{ sip.absolute_returns|currency }}
                        </td>
                        <td style="color: {% if sip.returns_percent > 0 %}var(--success){% elif sip.returns_percent < 0 %}var(--danger){% else %}var(--text-secondary){% endif %}">
                            {{ sip.returns_percent|percentage }}
                        </td>
                        <td style="color: {% if sip.xirr > 0 %}var(--success){% elif sip.xirr < 0 %}var(--danger){% else %}var(--text-secondary){% endif %}">
                            {{ sip.xirr|percentage }}
                        </td>
                        <td style="font-size: 0.875rem;">{{ sip.last_installment_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Inactive SIPs -->
    {% if inactive_sips %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Inactive SIPs</h3>
            <p style="color: var(--text-muted); font-size: 0.875rem;">{{ inactive_sips|length }} stopped or completed SIPs</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 30%;">Scheme Name</th>
                        <th>SIP Amount</th>
                        <th>Frequency</th>
                        <th>Total Invested</th>
                        <th>Installments</th>
                        <th>Last Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sip in inactive_sips %}
                    <tr style="opacity: 0.7;">
                        <td>
                            <div class="scheme-name" title="{{ sip.scheme_name }}">
                                {{ sip.scheme_name }}
                            </div>
                            <span class="folio-number">{{ sip.folio_number }}</span>
                        </td>
                        <td>{{ sip.sip_amount|currency }}</td>
                        <td>{{ sip.frequency }}</td>
                        <td>{{ sip.total_invested_sip|currency }}</td>
                        <td>{{ sip.total_installments }}</td>
                        <td style="font-size: 0.875rem;">{{ sip.last_installment_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="card" style="text-align: center; padding: 4rem 2rem;">
        <h2 style="color: var(--text-muted); margin-bottom: 1rem;">No SIP Data</h2>
        <p style="color: var(--text-muted); margin-bottom: 2rem;">
            Please upload your portfolio data first
        </p>
        <a href="{{ url_for('upload') }}" class="btn btn-primary">Upload Data</a>
    </div>
    {% endif %}
</div>
{% endblock %}